properties([
        parameters([
                choice(choices: ['qa', 'dev'], name: 'ENV', description: 'On which environment should I run checks?'),
                string(defaultValue: 'https://selenide.org', name: 'BASE_URL', description: 'Specify BASE_URL By default "https://selenide.org"')
        ])
])

pipeline {
    agent any
    tools {
        maven "MAVEN"
        jdk "JAVA"
        allure "ALLURE"
    }
    stages {
        stage('Initialize'){
            steps{
                echo "PATH = ${M2_HOME}/bin:${PATH}"
                echo "M2_HOME = /opt/maven"
                echo "BASE_URL = " + params.BASE_URL
                echo "ENV = " + params.ENV
            }
        }
        stage('Build') {
                    steps {
                        bat 'mvn -B -DskipTests clean compile'
//                         sh 'mvn -B -DskipTests clean compile'
                    }
                }
        stage('Test on QA') {
             when {
                  expression {
                  return params.ENV == 'qa'
                  }
            }
            steps {
                echo "Test on QA"
                bat 'mvn test -DBASE_URL=' + params.BASE_URL
//                 sh 'mvn test'
            }
        }
          stage('Test on DEV') {
                     when {
                          expression {
                          return params.ENV == 'dev'
                          }
                    }
                    steps {
                        echo "Test on DEV"
                        bat 'mvn test'
        //                 sh 'mvn test'
                    }
                }

     }
      post {
          always {
            script {
              allure([
                includeProperties: false,
                jdk: '',
                properties: [],
                reportBuildPolicy: 'ALWAYS',
                results: [[path: 'target/allure-results']]
              ])
            }
          }
        }
}