properties([
        parameters([
//                 booleanParam(name: 'xray', defaultValue: false, description: 'Would you like to update results on XRAY?'),
//                 string(defaultValue: 'HSA-2339', name: 'XRAY_EXECUTION_KEY', description: 'Specify XRAY_EXECUTION_KEY. By default "HSA-1552"'),
                choice(choices: ['qa', 'dev'], name: 'env', description: 'On which environment should I run checks?'),
//                 string(defaultValue: '', name: 'groups', description: 'Choose test groups to run from [admin, employee, retro]. Single group example: "group1". Multiple groups separated with comma: "group1,group2,...,groupN". By default all groups are selected.'),
//                 string(defaultValue: 'retro,templates', name: 'excludeGroups', description: 'Choose test groups to exclude from run. Single group example: "group1". Multiple groups separated with comma: "group1,group2,...,groupN". By default all groups are selected.'),
//                 string(defaultValue: '', name: 'branch', description: 'Choose repo branch to run tests from')
        ])
])

pipeline {
    agent any
    tools {
        maven "MAVEN"
        jdk "JAVA"
        allure "ALLURE"
    }
    stages {
        stage('Initialize'){
            steps{
                echo "PATH = ${M2_HOME}/bin:${PATH}"
                echo "M2_HOME = /opt/maven"
            }
        }
        stage('Build') {
        when { changeRequest target: 'master' }
//             when {
//                 allOf {
//                     anyOf {
//                         changeRequest()
//                         expression { env.BRANCH_NAME == 'master' }
//                     }
//                     not {
//                         triggeredBy cause: 'UserIdCause'
//                     }
//                 }
//             }
            steps {
                bat 'mvn clean test'
            }
        }

     }
      post {
          always {
            script {
              allure([
                includeProperties: false,
                jdk: '',
                properties: [],
                reportBuildPolicy: 'ALWAYS',
                results: [[path: 'target/allure-results']]
              ])
            }
          }
        }
}